# Implementation Plan: Unread Article Count Badge

**Branch**: `002-unread-badge` | **Date**: 2026-02-27 | **Spec**: [spec.md](./spec.md)

## Summary

Add real-time unread article count badges to the subscription list (US1), refreshing the count after a manual per-feed refresh (US2) and after toggling article read/unread status (US3). Three new Application-layer use cases are required. The Presentation layer gains a per-feed Refresh button wired into the existing `FeedListViewModel`, a new `ArticleListPage` + `ArticleListViewModel` for US3, and reactive `ObservableCollection<FeedDto>` updates that replace a single item in-place rather than reloading the full list.

## Technical Context

**Language/Version**: C# 12 / .NET 8 LTS
**Primary Dependencies**: .NET MAUI, EF Core 8 + SQLite, System.ServiceModel.Syndication, HtmlSanitizer 9.0.892, Microsoft.Extensions.Http
**Storage**: SQLite (existing schema; `Article.IsRead` column and all required queries already present — no migration needed)
**Testing**: xUnit + Moq; in-memory SQLite (Microsoft.Data.Sqlite)
**Target Platform**: macOS MacCatalyst, Windows
**Project Type**: MAUI desktop app (Clean Architecture — Domain / Application / Infrastructure / Presentation)
**Performance Goals**: Badge update visible within the same user interaction; per-feed refresh honours existing 10 s timeout
**Constraints**: UI-thread non-blocking; no new NuGet packages; all changes stay within existing architecture
**Scale/Scope**: Single-user, local-first; up to 500 subscribed feeds (per spec SC-003)

## Constitution Check

### I. Security by Design ✅ PASS

No new network surfaces. The per-feed refresh reuses `FeedFetcherService` (SSRF guard, 10 s timeout, TLS enforcement, HtmlSanitizer). Article read-status toggle operates only on local SQLite data.

### II. Maintainability & Clean Architecture ✅ PASS

New use cases (`RefreshFeedSubscription`, `MarkArticleAsRead`, `ToggleArticleReadStatus`) are placed in Application, matching the existing `AddFeedSubscription`/`GetFeeds` pattern. `ArticleListViewModel` depends only on Application-layer handlers. No cross-layer leakage.

### III. Code Quality Standards ✅ PASS

All new files inherit `TreatWarningsAsErrors`, nullable, SonarAnalyzer from `Directory.Build.props`. XML `/// <summary>` required on all public APIs.

### IV. Reliability & Resilience ✅ PASS

Refresh path is unchanged from `FeedFetcherService` (per-feed isolation, 10 s timeout, async throughout). Badge update is a local SQLite read — no reliability risk.

### V. Testable by Default ✅ PASS

All three new handlers are unit-tested via Moq. `ArticleListViewModel` logic is tested via mock handlers. `ArticleRepository.MarkAsReadAsync` and `ToggleReadStatusAsync` covered by integration tests with in-memory SQLite.

No violations — Complexity Tracking table not required.

## Project Structure

### Documentation (this feature)

```text
specs/002-unread-badge/
├── plan.md              ← this file
├── research.md
├── data-model.md
├── quickstart.md
├── contracts/
│   ├── RefreshFeedSubscriptionHandler.md
│   └── ArticleListViewModel.md
└── tasks.md             ← generated by /speckit.tasks
```

### Source Code additions / changes

```text
src/RSSFeedReader.Application/
├── DTOs/
│   └── ArticleDto.cs                                         (new)
└── UseCases/
    ├── RefreshFeedSubscription/
    │   ├── RefreshFeedSubscriptionCommand.cs                 (new)
    │   └── RefreshFeedSubscriptionHandler.cs                 (new)
    ├── MarkArticleAsRead/
    │   ├── MarkArticleAsReadCommand.cs                       (new)
    │   └── MarkArticleAsReadHandler.cs                       (new)
    └── ToggleArticleReadStatus/
        ├── ToggleArticleReadStatusCommand.cs                 (new)
        └── ToggleArticleReadStatusHandler.cs                 (new)

src/RSSFeedReader.Presentation/
├── Pages/
│   ├── ArticleListPage.xaml                                  (new)
│   ├── ArticleListPage.xaml.cs                               (new)
│   └── FeedListPage.xaml                                     (update — add Refresh + tap-to-articles per cell)
├── ViewModels/
│   ├── ArticleListViewModel.cs                               (new)
│   └── FeedListViewModel.cs                                  (update — add RefreshFeedCommand, NavigateToArticlesCommand, UpdateUnreadCount)
├── AppShell.xaml                                             (update — register ArticleList route)
└── MauiProgram.cs                                            (update — register new handlers / pages / VMs)

tests/RSSFeedReader.Application.Tests/UseCases/
├── RefreshFeedSubscriptionHandlerTests.cs                    (new)
├── MarkArticleAsReadHandlerTests.cs                          (new)
└── ToggleArticleReadStatusHandlerTests.cs                    (new)

tests/RSSFeedReader.Infrastructure.Tests/Persistence/
└── ArticleRepositoryReadStatusTests.cs                       (new — MarkAsRead + Toggle integration tests)
```

**Structure Decision**: Pure extension of the existing 4-layer layout. No new projects. All new Application code mirrors the `AddFeedSubscription` pattern (sealed command record, sealed handler class, sealed result record with error enum). All new Presentation code mirrors the `FeedListPage`/`FeedListViewModel` pattern.
